(()=>{"use strict";const e=window.wp.element,t=window.wp.i18n,i=window.wp.blockEditor,r=window.wp.components,o=window.wp.blocks;function n(e){return e.includes("?")&&(e=e.split("?")[0]),e.includes("/")&&(e=e.split("/")[0]),e.includes("&")&&(e=e.split("&")[0]),e}function c(e){var t=e;t=(t=t.replace(/#t=.*$/,"")).replace(/^https?:\/\//,"");var i=/youtube:\/\/|youtu\.be\/|y2u\.be\//g;if(i.test(t))return n(t.split(i)[1]);var r=/\/shorts\//g;if(r.test(t))return n(t.split(r)[1]);var o=/v=|vi=/g;if(o.test(t))return n(t.split(o)[1].split("&")[0]);var c=/\/v\/|\/vi\/|\/watch\//g;if(c.test(t))return n(t.split(c)[1]);var d=/\/an_webp\//g;if(d.test(t))return n(t.split(d)[1]);var a=/\/e\//g;if(a.test(t))return n(t.split(a)[1]);var s=/\/embed\//g;if(s.test(t))return n(t.split(s)[1]);if(!/\/user\/([a-zA-Z\d]*)$/g.test(t)){if(/\/user\/(?!.*videos)/g.test(t))return n(t.split("/").pop());var l=/\/attribution_link\?.*v%3D([^%&]*)(%26|&|$)/;return l.test(t)?n(t.match(l)[1]):void 0}}function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var r,o,n=[],_n=!0,c=!1;try{for(i=i.call(e);!(_n=(r=i.next()).done)&&(n.push(r.value),!t||n.length!==t);_n=!0);}catch(e){c=!0,o=e}finally{try{_n||null==i.return||i.return()}finally{if(c)throw o}}return n}}(e,t)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?a(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function s(e){var t,i,r=e;if(r.includes("#")){var o=r.split("#");r=d(o,1)[0]}if(r.includes("?")&&!r.includes("clip_id=")){var n=r.split("?");r=d(n,1)[0]}var c=/https?:\/\/vimeo\.com\/event\/(\d+)$/.exec(r);if(c&&c[1])return c[1];var a=/https?:\/\/vimeo\.com\/(\d+)/.exec(r);if(a&&a[1])return a[1];var s=["https?://player.vimeo.com/video/[0-9]+$","https?://vimeo.com/channels","groups","album"].join("|");return new RegExp(s,"gim").test(r)?(i=r.split("/"))&&i.length>0&&(t=i.pop()):/clip_id=/gim.test(r)&&(i=r.split("clip_id="))&&i.length>0&&(t=d(i[1].split("&"),1)[0]),t}function l(e){var t=/https:\/\/vine\.co\/v\/([a-zA-Z\d]*)\/?/.exec(e);if(t&&t.length>1)return t[1]}function v(e){var t;if(e.includes("embed"))return t=/embed\/(\w{8})/,e.match(t)[1];t=/\/v\/(\w{8})/;var i=e.match(t);return i&&i.length>0?i[1]:void 0}function u(e){var t=(e.includes("embed")?/https:\/\/web\.microsoftstream\.com\/embed\/video\/([a-zA-Z\d-]*)\/?/:/https:\/\/web\.microsoftstream\.com\/video\/([a-zA-Z\d-]*)\/?/).exec(e);if(t&&t.length>1)return t[1]}function p(e){var t=/tiktok\.com(.*)\/video\/(\d+)/gm.exec(e);if(t&&t.length>2)return t[2]}function m(e){var t=/dailymotion\.com(.*)(video)\/([a-zA-Z\d]+)/gm.exec(e);if(t)return t[3];var i=/dai\.ly\/([a-zA-Z\d]+)/gm.exec(e);if(i&&i.length>1)return i[1];var r=/dailymotion\.com(.*)video=([a-zA-Z\d]+)/gm.exec(e);return r&&r.length>2?r[2]:void 0}const f={videoUrl:{type:"string"},videoId:{type:"string"},videoService:{type:"string"},cannotEmbed:{type:"boolean"}};(0,o.registerBlockType)("protected-video/protected-video",{title:(0,t.__)("Protected Video","protected-video"),description:(0,t.__)("YouTube/Vimeo player that prevents easy sharing of the video.","protected-video"),icon:"lock",category:"embed",attributes:f,edit(o){const{videoUrl:n,videoId:d,videoService:a,cannotEmbed:f}=o.attributes;return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(r.Placeholder,{icon:(0,e.createElement)(i.BlockIcon,{icon:"lock"}),label:(0,t.__)("Protected Video","protected-video"),className:"wp-block-protected-video",instructions:(0,t.__)("Paste the URL of a YouTube or Vimeo video you want to display in a protected player.","protected-video")},(0,e.createElement)(r.TextControl,{label:(0,t.__)("Video URL","protected-video"),value:n,onChange:function(e){const t=function(e){if("string"!=typeof e)throw new TypeError("get-video-id expects a string");var t=e;/<iframe/gi.test(t)&&(t=function(e){if("string"!=typeof e)throw new TypeError("getSrc expected a string");var t=/src="(.*?)"/gm.exec(e);if(t&&t.length>=2)return t[1]}(t)||""),t=(t=(t=t.trim()).replace("-nocookie","")).replace("/www.","/");var i={id:null,service:null};if(/\/\/google/.test(t)){var r=t.match(/url=([^&]+)&/);r&&(t=decodeURIComponent(r[1]))}return/youtube|youtu\.be|y2u\.be|i.ytimg\./.test(t)?i={id:c(t),service:"youtube"}:/vimeo/.test(t)?i={id:s(t),service:"vimeo"}:/vine/.test(t)?i={id:l(t),service:"vine"}:/videopress/.test(t)?i={id:v(t),service:"videopress"}:/microsoftstream/.test(t)?i={id:u(t),service:"microsoftstream"}:/tiktok\.com/.test(t)?i={id:p(t),service:"tiktok"}:/(dailymotion\.com|dai\.ly)/.test(t)&&(i={id:m(t),service:"dailymotion"}),i}(e);o.setAttributes({videoUrl:e,videoId:t.id,videoService:t.service,cannotEmbed:e&&!t.id})},placeholder:(0,t.__)("e.g. https://youtu.be/c_hO_fjmMnk","protected-video")}),d&&(0,e.createElement)("div",null,(0,e.createElement)("img",{src:"youtube"==a?`https://i.ytimg.com/vi/${d}/mqdefault.jpg`:"vimeo"==a?`https://vumbnail.com/${d}.jpg`:void 0,width:"320",height:"180",alt:(0,t.__)("Video thumbnail","protected-video")})),f&&(0,e.createElement)("div",null,(0,t.__)("Sorry, a video ID could not be found in that URL.","protected-video"))))},save(t){const{videoId:i,videoService:r}=t.attributes;return(0,e.createElement)("div",{className:"wp-block-protected-video","data-id1":btoa(r),"data-id2":btoa(i)})},deprecated:[{attributes:f,save(t){const{videoId:i,videoService:r}=t.attributes;return(0,e.createElement)("div",{className:"wp-block-protected-video","data-plyr-provider":r,"data-plyr-embed-id":i})}}]})})();